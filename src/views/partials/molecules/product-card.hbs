{{!--
  Product Card Molecule Component
  Usage: {{> product-card product=product }}
--}}
<div class="flex flex-col bg-white dark:bg-background-dark border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden group">
  <div class="relative">
    <a href="/products/{{product.id}}">
      {{#if product.images}}
        {{#each product.images}}
          {{#if isPrimary}}
            <div class="bg-center bg-no-repeat aspect-square bg-cover w-full bg-white dark:bg-slate-800/50"
              data-alt="{{altText}}"
              style="background-image: url('{{url}}');">
            </div>
          {{/if}}
        {{/each}}
        {{#hasPrimaryImage product.images}}
        {{else}}
          <div class="bg-center bg-no-repeat aspect-square bg-cover w-full bg-white dark:bg-slate-800/50"
            data-alt="{{product.name}}"
            style="background-image: url('{{product.images.[0].url}}');">
          </div>
        {{/hasPrimaryImage}}
      {{else}}
        <div class="bg-center bg-no-repeat aspect-square bg-cover w-full bg-white dark:bg-slate-800/50"
          data-alt="{{product.name}}"
          style="background-image: url('/images/placeholder.png');">
        </div>
      {{/if}}
    </a>
    {{#if showCheckbox}}
      <input
        class="absolute top-3 left-3 h-5 w-5 rounded border-gray-400 bg-white/50 backdrop-blur-sm text-primary checked:bg-primary checked:border-primary focus:ring-2 focus:ring-offset-0 focus:ring-primary/50"
        type="checkbox" data-product-id="{{product.id}}" />
    {{/if}}
  </div>
  <div class="p-4 flex flex-col gap-3 flex-1">
    <a href="/products/{{product.id}}">
      <h3 class="font-bold text-gray-900 dark:text-white hover:text-primary transition-colors">
        {{product.name}}
      </h3>
    </a>
    <p class="text-xs text-gray-500 dark:text-gray-400">SKU: {{product.sku}}</p>
    <div class="flex-1"></div>
    <div class="flex items-center justify-between">
      {{#if @root.isAuthenticated}}
        <p class="text-lg font-extrabold text-gray-900 dark:text-white">
          {{formatCurrency product.basePrice product.currency}}
        </p>
      {{/if}}
      {{#if product.isActive}}
        <span class="inline-flex items-center gap-1.5 rounded-full bg-green-100 dark:bg-green-900/50 px-2 py-1 text-xs font-medium text-green-700 dark:text-green-300">
          <span class="size-1.5 rounded-full bg-green-500"></span>
          In Stock
        </span>
      {{else}}
        <span class="inline-flex items-center gap-1.5 rounded-full bg-red-100 dark:bg-red-900/50 px-2 py-1 text-xs font-medium text-red-700 dark:text-red-300">
          <span class="size-1.5 rounded-full bg-red-500"></span>
          Out of Stock
        </span>
      {{/if}}
    </div>
  </div>
  {{#if @root.isAuthenticated}}
    <div class="border-t border-gray-200 dark:border-gray-700 p-4 flex items-center gap-2">
      <input
        class="form-input w-16 text-center rounded-lg bg-background-light dark:bg-gray-800 border-gray-300 dark:border-gray-600 focus:ring-primary focus:border-primary"
        type="number"
        value="{{product.minOrderQuantity}}"
        min="{{product.minOrderQuantity}}"
        {{#if product.maxOrderQuantity}}max="{{product.maxOrderQuantity}}"{{/if}}
        data-product-id="{{product.id}}"
        {{#unless product.isActive}}disabled{{/unless}}
      />
      <button
        class="flex-1 flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 {{#if product.isActive}}bg-primary text-white hover:bg-primary/90{{else}}bg-primary/20 text-primary hover:bg-primary/30 cursor-not-allowed{{/if}} gap-2 text-sm font-bold leading-normal tracking-[0.015em]"
        data-product-id="{{product.id}}"
        {{#unless product.isActive}}disabled{{/unless}}
        onclick="addToCart('{{product.id}}', this.previousElementSibling.value)">
        Add to Cart
      </button>
    </div>
  {{/if}}
</div>

