{{> header}}

<main class="flex-1 bg-background-light dark:bg-background-dark">
    <div class="page-container">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-title">Product Catalog</h1>
            <p class="page-subtitle">Browse our extensive collection of high-quality products</p>
        </div>

        <!-- Filters and Search Bar -->
        <div class="mb-8 flex flex-col gap-4 rounded-xl bg-white dark:bg-slate-800/50 p-6">
            <div class="grid grid-cols-1 gap-4 md:grid-cols-3">
                <!-- Category Filter -->
                <div>
                    <label class="form-label" for="category">Category</label>
                    <select class="form-select" id="category" name="category">
                        <option value="">All Categories</option>
                        <option value="electronics">Electronics</option>
                        <option value="office">Office Supplies</option>
                        <option value="industrial">Industrial</option>
                        <option value="technology">Technology</option>
                    </select>
                </div>

                <!-- Price Range Filter -->
                <div>
                    <label class="form-label" for="priceRange">Price Range</label>
                    <select class="form-select" id="priceRange" name="priceRange">
                        <option value="">All Prices</option>
                        <option value="0-50">$0 - $50</option>
                        <option value="50-100">$50 - $100</option>
                        <option value="100-500">$100 - $500</option>
                        <option value="500+">$500+</option>
                    </select>
                </div>

                <!-- Sort By -->
                <div>
                    <label class="form-label" for="sort">Sort By</label>
                    <select class="form-select" id="sort" name="sort">
                        <option value="featured">Featured</option>
                        <option value="price-asc">Price: Low to High</option>
                        <option value="price-desc">Price: High to Low</option>
                        <option value="newest">Newest First</option>
                        <option value="name">Name: A-Z</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Products Grid -->
        <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4">
            {{#each products}}
                <div class="product-card">
                    <a href="/products/{{this.id}}" class="block">
                        <div class="product-image-wrapper">
                            <img src="{{this.image}}" alt="{{this.name}}" class="product-image">
                            {{#if this.inStock}}
                                <span class="product-badge badge-success">In Stock</span>
                            {{else}}
                                <span class="product-badge badge-danger">Out of Stock</span>
                            {{/if}}
                            {{#if this.isNew}}
                                <span class="product-badge badge-info absolute top-2 left-2">New</span>
                            {{/if}}
                        </div>
                        <div class="mt-3">
                            <div class="text-xs font-medium text-secondary uppercase tracking-wider mb-1">
                                {{this.category}}
                            </div>
                            <h3 class="text-base font-semibold text-text-headings dark:text-text-headings-dark mb-2 line-clamp-2">
                                {{this.name}}
                            </h3>
                            {{#if this.rating}}
                                <div class="flex items-center gap-2 mb-2">
                                    <div class="flex items-center">
                                        {{#each (range 5)}}
                                            <span class="material-symbols-outlined text-sm {{#if (lt @index ../this.rating)}}text-yellow-400{{else}}text-gray-300{{/if}}">star</span>
                                        {{/each}}
                                    </div>
                                    <span class="text-xs text-text-light dark:text-text-dark">({{this.rating}})</span>
                                </div>
                            {{/if}}
                            <div class="flex items-center justify-between">
                                <div class="text-2xl font-bold text-primary dark:text-secondary">
                                    ${{this.price}}
                                </div>
                                {{#if this.inStock}}
                                    <button class="btn btn-primary btn-sm" onclick="addToCart({{this.id}})">
                                        <span class="material-symbols-outlined text-base">add_shopping_cart</span>
                                    </button>
                                {{else}}
                                    <button class="btn btn-sm opacity-50 cursor-not-allowed" disabled>
                                        Out of Stock
                                    </button>
                                {{/if}}
                            </div>
                        </div>
                    </a>
                </div>
            {{else}}
                <div class="col-span-full">
                    <div class="card p-12 text-center">
                        <span class="material-symbols-outlined text-6xl text-gray-300 dark:text-gray-600 mb-4">inventory_2</span>
                        <h3 class="text-xl font-semibold text-text-headings dark:text-text-headings-dark mb-2">No products found</h3>
                        <p class="text-text-light dark:text-text-dark mb-6">Try adjusting your filters or search criteria</p>
                        <a href="/products" class="btn btn-primary">
                            Clear Filters
                        </a>
                    </div>
                </div>
            {{/each}}
        </div>

        <!-- Pagination -->
        {{#if pagination}}
            <div class="mt-12 flex items-center justify-center gap-2">
                {{#if pagination.hasPrev}}
                    <a href="?page={{pagination.prevPage}}" class="btn btn-outline">
                        <span class="material-symbols-outlined">chevron_left</span>
                    </a>
                {{/if}}

                {{#each pagination.pages}}
                    <a href="?page={{this.number}}" class="btn {{#if this.active}}btn-primary{{else}}btn-outline{{/if}}">
                        {{this.number}}
                    </a>
                {{/each}}

                {{#if pagination.hasNext}}
                    <a href="?page={{pagination.nextPage}}" class="btn btn-outline">
                        <span class="material-symbols-outlined">chevron_right</span>
                    </a>
                {{/if}}
            </div>
        {{/if}}
    </div>
</main>

{{> footer}}

<script>
function addToCart(productId) {
    fetch('/api/cart/add', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ productId, quantity: 1 })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('Product added to cart!');
            location.reload();
        } else {
            alert('Error adding to cart');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error adding to cart');
    });
}
</script>
