{{> header}}

<main class="flex-1 bg-background-light dark:bg-background-dark">
    <div class="page-container">
        <!-- Breadcrumb -->
        <nav class="mb-6 flex items-center gap-2 text-sm">
            <a href="/" class="text-text-light hover:text-primary dark:text-text-dark dark:hover:text-secondary">Home</a>
            <span class="text-gray-400">/</span>
            <a href="/products" class="text-text-light hover:text-primary dark:text-text-dark dark:hover:text-secondary">Products</a>
            <span class="text-gray-400">/</span>
            <span class="text-text-headings dark:text-text-headings-dark">{{product.name}}</span>
        </nav>

        <!-- Product Details -->
        <div class="grid grid-cols-1 gap-8 lg:grid-cols-2">
            <!-- Product Images -->
            <div class="space-y-4">
                <div class="aspect-square w-full overflow-hidden rounded-xl bg-white dark:bg-slate-800">
                    <img id="mainImage" src="{{product.image}}" alt="{{product.name}}" class="h-full w-full object-cover">
                </div>
                {{#if product.images}}
                    <div class="grid grid-cols-4 gap-4">
                        {{#each product.images}}
                            <button class="aspect-square overflow-hidden rounded-lg border-2 border-transparent hover:border-primary dark:hover:border-secondary transition-colors" onclick="changeImage('{{this}}')">
                                <img src="{{this}}" alt="{{../product.name}}" class="h-full w-full object-cover">
                            </button>
                        {{/each}}
                    </div>
                {{/if}}
            </div>

            <!-- Product Info -->
            <div class="space-y-6">
                <div>
                    <div class="text-sm font-medium text-secondary uppercase tracking-wider mb-2">
                        {{product.category}}
                    </div>
                    <h1 class="text-3xl font-bold text-text-headings dark:text-text-headings-dark mb-4">
                        {{product.name}}
                    </h1>

                    {{#if product.rating}}
                        <div class="flex items-center gap-4 mb-4">
                            <div class="flex items-center">
                                {{#each (range 5)}}
                                    <span class="material-symbols-outlined text-yellow-400">star</span>
                                {{/each}}
                            </div>
                            <span class="text-sm text-text-light dark:text-text-dark">
                                {{product.rating}} ({{product.reviewCount}} reviews)
                            </span>
                        </div>
                    {{/if}}

                    <div class="flex items-baseline gap-4 mb-6">
                        <div class="text-4xl font-bold text-primary dark:text-secondary">
                            ${{product.price}}
                        </div>
                        {{#if product.originalPrice}}
                            <div class="text-xl text-gray-400 line-through">
                                ${{product.originalPrice}}
                            </div>
                            <span class="product-badge badge-success">
                                Save {{product.discount}}%
                            </span>
                        {{/if}}
                    </div>

                    <p class="text-text-light dark:text-text-dark leading-relaxed">
                        {{product.description}}
                    </p>
                </div>

                <!-- Stock Status -->
                <div class="flex items-center gap-3">
                    {{#if product.inStock}}
                        <span class="flex items-center gap-2 text-green-600 dark:text-green-400">
                            <span class="material-symbols-outlined">check_circle</span>
                            <span class="font-semibold">In Stock</span>
                        </span>
                        <span class="text-text-light dark:text-text-dark">
                            {{product.stockCount}} units available
                        </span>
                    {{else}}
                        <span class="flex items-center gap-2 text-red-600 dark:text-red-400">
                            <span class="material-symbols-outlined">cancel</span>
                            <span class="font-semibold">Out of Stock</span>
                        </span>
                    {{/if}}
                </div>

                <!-- Quantity Selector -->
                {{#if product.inStock}}
                    <div class="space-y-4">
                        <div>
                            <label class="form-label">Quantity</label>
                            <div class="flex items-center gap-4">
                                <button class="btn btn-outline" onclick="decreaseQuantity()">
                                    <span class="material-symbols-outlined">remove</span>
                                </button>
                                <input type="number" id="quantity" value="1" min="1" max="{{product.stockCount}}" class="form-input w-20 text-center">
                                <button class="btn btn-outline" onclick="increaseQuantity()">
                                    <span class="material-symbols-outlined">add</span>
                                </button>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="flex flex-col sm:flex-row gap-4">
                            <button class="btn btn-primary btn-lg flex-1" onclick="addToCart()">
                                <span class="material-symbols-outlined mr-2">add_shopping_cart</span>
                                Add to Cart
                            </button>
                            <button class="btn btn-outline btn-lg">
                                <span class="material-symbols-outlined">favorite_border</span>
                            </button>
                        </div>
                    </div>
                {{else}}
                    <button class="btn btn-lg w-full" disabled>
                        Out of Stock - Notify When Available
                    </button>
                {{/if}}

                <!-- Product Features -->
                {{#if product.features}}
                    <div class="space-y-3 border-t border-gray-200 dark:border-gray-700 pt-6">
                        <h3 class="font-semibold text-text-headings dark:text-text-headings-dark">Key Features</h3>
                        <ul class="space-y-2">
                            {{#each product.features}}
                                <li class="flex items-start gap-2">
                                    <span class="material-symbols-outlined text-secondary text-sm mt-0.5">check</span>
                                    <span class="text-text-light dark:text-text-dark">{{this}}</span>
                                </li>
                            {{/each}}
                        </ul>
                    </div>
                {{/if}}

                <!-- Shipping Info -->
                <div class="border-t border-gray-200 dark:border-gray-700 pt-6 space-y-3">
                    <div class="flex items-center gap-3 text-text-light dark:text-text-dark">
                        <span class="material-symbols-outlined text-secondary">local_shipping</span>
                        <span>Free shipping on orders over $100</span>
                    </div>
                    <div class="flex items-center gap-3 text-text-light dark:text-text-dark">
                        <span class="material-symbols-outlined text-secondary">autorenew</span>
                        <span>30-day return policy</span>
                    </div>
                    <div class="flex items-center gap-3 text-text-light dark:text-text-dark">
                        <span class="material-symbols-outlined text-secondary">verified</span>
                        <span>1-year warranty included</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Product Details Tabs -->
        <div class="mt-12">
            <div class="card">
                <div class="border-b border-gray-200 dark:border-gray-700">
                    <nav class="flex gap-8 px-6 pt-6">
                        <button class="pb-4 border-b-2 border-primary font-semibold text-primary dark:border-secondary dark:text-secondary">
                            Description
                        </button>
                        <button class="pb-4 border-b-2 border-transparent font-semibold text-text-light hover:text-text-headings dark:text-text-dark dark:hover:text-text-headings-dark">
                            Specifications
                        </button>
                        <button class="pb-4 border-b-2 border-transparent font-semibold text-text-light hover:text-text-headings dark:text-text-dark dark:hover:text-text-headings-dark">
                            Reviews
                        </button>
                    </nav>
                </div>
                <div class="p-6">
                    <div class="prose dark:prose-invert max-w-none">
                        <p class="text-text-light dark:text-text-dark">
                            {{product.fullDescription}}
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

{{> footer}}

<script>
let maxQuantity = {{product.stockCount}};

function changeImage(src) {
    document.getElementById('mainImage').src = src;
}

function increaseQuantity() {
    const input = document.getElementById('quantity');
    const current = parseInt(input.value);
    if (current < maxQuantity) {
        input.value = current + 1;
    }
}

function decreaseQuantity() {
    const input = document.getElementById('quantity');
    const current = parseInt(input.value);
    if (current > 1) {
        input.value = current - 1;
    }
}

function addToCart() {
    const quantity = parseInt(document.getElementById('quantity').value);
    fetch('/api/cart/add', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            productId: '{{product.id}}',
            quantity: quantity
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('Product added to cart!');
            window.location.href = '/cart';
        } else {
            alert('Error adding to cart');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error adding to cart');
    });
}
</script>
